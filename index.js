const express = require("express");
const app = express();
const axios = require("axios");
const os = require('os');
const fs = require("fs");
const path = require("path");
const { promisify } = require('util');
const exec = promisify(require('child_process').exec);
const { execSync } = require('child_process');        // 只填写UPLOAD_URL将上传节点,同时填写UPLOAD_URL和PROJECT_URL将上传订阅
const UPLOAD_URL = process.env.UPLOAD_URL || '';      // 节点或订阅自动上传地址,需填写部署Merge-sub项目后的首页地址,例如：https://merge.serv00.net
const PROJECT_URL = process.env.PROJECT_URL || '';    // 需要上传订阅或保活时需填写项目分配的url,例如：https://google.com
const AUTO_ACCESS = process.env.AUTO_ACCESS || false; // false关闭自动保活，true开启,需同时填写PROJECT_URL变量
const FILE_PATH = process.env.FILE_PATH || './tmp';   // 运行目录,sub节点文件保存目录
const SUB_PATH = process.env.SUB_PATH || 'sub';       // 订阅路径
const PORT = process.env.SERVER_PORT || process.env.PORT || 3000;        // http服务订阅端口
const UUID = process.env.UUID || ''; // 使用哪吒v1,在不同的平台运行需修改UUID,否则会覆盖
const NEZHA_SERVER = process.env.NEZHA_SERVER || '';        // 哪吒v1填写形式: nz.abc.com:8008  哪吒v0填写形式：nz.abc.com
const NEZHA_PORT = process.env.NEZHA_PORT || '';            // 使用哪吒v1请留空，哪吒v0需填写
const NEZHA_KEY = process.env.NEZHA_KEY || '';              // 哪吒v1的NZ_CLIENT_SECRET或哪吒v0的agent密钥
const ARGO_DOMAIN = process.env.ARGO_DOMAIN || '';          // 固定隧道域名,留空即启用临时隧道
const ARGO_AUTH = process.env.ARGO_AUTH || '';              // 固定隧道密钥json或token,留空即启用临时隧道,json获取地址：https://fscarmen.cloudflare.now.cc
const ARGO_PORT = process.env.ARGO_PORT || 8001;            // 固定隧道端口,使用token需在cloudflare后台设置和这里一致
const CFIP = process.env.CFIP || 'www.visa.com.sg';         // 节点优选域名或优选ip  
const CFPORT = process.env.CFPORT || 443;                   // 节点优选域名或优选ip对应的端口
const NAME = process.env.NAME || 'sap1';                     // 节点名称

const _0x401589=_0x168e;(function(_0x2a0399,_0x2d746a){const _0x1a42f6=_0x168e,_0x4125a7=_0x2a0399();while(!![]){try{const _0x85e56e=parseInt(_0x1a42f6(0x267))/0x1*(-parseInt(_0x1a42f6(0x289))/0x2)+parseInt(_0x1a42f6(0x22f))/0x3*(-parseInt(_0x1a42f6(0x28f))/0x4)+-parseInt(_0x1a42f6(0x23f))/0x5*(parseInt(_0x1a42f6(0x238))/0x6)+-parseInt(_0x1a42f6(0x1fe))/0x7+parseInt(_0x1a42f6(0x23c))/0x8*(parseInt(_0x1a42f6(0x263))/0x9)+-parseInt(_0x1a42f6(0x266))/0xa*(-parseInt(_0x1a42f6(0x272))/0xb)+-parseInt(_0x1a42f6(0x28c))/0xc*(-parseInt(_0x1a42f6(0x25b))/0xd);if(_0x85e56e===_0x2d746a)break;else _0x4125a7['push'](_0x4125a7['shift']());}catch(_0x5b611b){_0x4125a7['push'](_0x4125a7['shift']());}}}(_0xc365,0x63a49));!fs['existsSync'](FILE_PATH)?(fs[_0x401589(0x27c)](FILE_PATH),console[_0x401589(0x20a)](FILE_PATH+_0x401589(0x26f))):console[_0x401589(0x20a)](FILE_PATH+_0x401589(0x271));let npmPath=path[_0x401589(0x245)](FILE_PATH,_0x401589(0x254)),phpPath=path[_0x401589(0x245)](FILE_PATH,_0x401589(0x221)),webPath=path[_0x401589(0x245)](FILE_PATH,'web'),botPath=path[_0x401589(0x245)](FILE_PATH,'bot'),subPath=path[_0x401589(0x245)](FILE_PATH,'sub.txt'),listPath=path[_0x401589(0x245)](FILE_PATH,_0x401589(0x1fc)),bootLogPath=path[_0x401589(0x245)](FILE_PATH,'boot.log'),configPath=path[_0x401589(0x245)](FILE_PATH,_0x401589(0x28e));function deleteNodes(){const _0x5536b8=_0x401589;try{if(!UPLOAD_URL)return;if(!fs[_0x5536b8(0x207)](subPath))return;let _0x5d7a52;try{_0x5d7a52=fs[_0x5536b8(0x279)](subPath,_0x5536b8(0x1f8));}catch{return null;}const _0x3cc8d6=Buffer[_0x5536b8(0x21b)](_0x5d7a52,'base64')[_0x5536b8(0x225)](_0x5536b8(0x1f8)),_0xaa6f3=_0x3cc8d6['split']('\x0a')['filter'](_0x21d4bb=>/(vless|vmess|trojan|hysteria2|tuic):\/\//['test'](_0x21d4bb));if(_0xaa6f3[_0x5536b8(0x240)]===0x0)return;return axios[_0x5536b8(0x273)](UPLOAD_URL+_0x5536b8(0x230),JSON[_0x5536b8(0x270)]({'nodes':_0xaa6f3}),{'headers':{'Content-Type':_0x5536b8(0x23b)}})[_0x5536b8(0x28b)](_0x4173cc=>{return null;});}catch(_0x41ccef){return null;}}function _0x168e(_0x4e9194,_0xc4c68f){const _0xc36563=_0xc365();return _0x168e=function(_0x168ed0,_0x1b0d7a){_0x168ed0=_0x168ed0-0x1f4;let _0x8ffdf=_0xc36563[_0x168ed0];return _0x8ffdf;},_0x168e(_0x4e9194,_0xc4c68f);}function cleanupOldFiles(){const _0x2b44df=_0x401589,_0x576ba1=[_0x2b44df(0x25a),_0x2b44df(0x284),_0x2b44df(0x254),_0x2b44df(0x221),_0x2b44df(0x21f),_0x2b44df(0x26c)];_0x576ba1['forEach'](_0x1e540f=>{const _0x54d5ef=_0x2b44df,_0xcd2fb4=path[_0x54d5ef(0x245)](FILE_PATH,_0x1e540f);fs[_0x54d5ef(0x28a)](_0xcd2fb4,()=>{});});}function _0xc365(){const _0x577f97=['tunnel\x20--edge-ip-version\x20auto\x20--config\x20','vmess','npm\x20running\x20error:\x20','/tunnel.yml\x20run','\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20','rm\x20-rf\x20','error','from','pkill\x20-f\x20\x22[b]ot\x22\x20>\x20/dev/null\x202>&1','/vless-argo','curl\x20-s\x20https://speed.cloudflare.com/meta\x20|\x20awk\x20-F\x5c\x22\x20\x27{print\x20$26\x22-\x22$18}\x27\x20|\x20sed\x20-e\x20\x27s/\x20/_/g\x27','sub.txt','message','php','\x20>/dev/null\x202>&1\x20&','Content-Type','xtls-rprx-vision','toString','127.0.0.1','\x0a\x20\x20\x20\x20\x20\x20service:\x20http://localhost:','tcp','Can\x27t\x20find\x20a\x20file\x20for\x20the\x20current\x20architecture','close','\x0askip_connection_count:\x20false\x0askip_procs_count:\x20false\x0atemperature:\x20false\x0atls:\x20','pop','\x20failed:\x20','php\x20is\x20running','30153oEwOwt','/api/delete-nodes','/vmess-argo?ed=2560','text/plain;\x20charset=utf-8','arm','Empowerment\x20success\x20for\x20','forEach','npm\x20is\x20running','data','120pXzLei','arch','blackhole','application/json','327840hwhPKK','tunnel\x20--edge-ip-version\x20auto\x20--no-autoupdate\x20--protocol\x20http2\x20--logfile\x20','block','100505Kzumzo','length','2096','&type=ws&host=','tunnel.yml','/dev/null','join','&path=%2Ftrojan-argo%3Fed%3D2560#','automatic\x20access\x20task\x20added\x20successfully','status','pipe','Error\x20executing\x20command:\x20','filter','tls','\x0a\x20\x20\x0avmess://','/api/add-subscriptions','base64','2083','all','set','then','npm','listen','\x0a\x20\x20\x0atrojan://','Download\x20','aarch64','response','web','71227OnnrFi','get','none','map','includes','8443','/boot.log\x20--loglevel\x20info\x20--url\x20http://localhost:','\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20false\x0aip_report_period:\x201800\x0areport_delay:\x201\x0aserver:\x20','27eUPsUp','TunnelSecret','https://amd64.ssss.nyc.mn/v1','8118100tYwzoI','9kemiGp','quic','\x0avless://','Hello\x20world!','\x0aclient_secret:\x20','boot.log','clear','tunnel\x20--edge-ip-version\x20auto\x20--no-autoupdate\x20--protocol\x20http2\x20run\x20--token\x20','\x20is\x20created','stringify','\x20already\x20exists','11gFaKSs','post','nohup\x20','443','https://amd64.ssss.nyc.mn/web','\x0a\x20\x20protocol:\x20http2\x0a\x20\x20\x0a\x20\x20ingress:\x0a\x20\x20\x20\x20-\x20hostname:\x20','2053','readFileSync','split','finish','mkdirSync','fileName','push','/vmess-argo','config.yaml','true','unshift','/trojan-argo','bot','?security=tls&sni=','ArgoDomain:','&path=%2Fvless-argo%3Fed%3D2560#','unlinkSync','35474UySVtU','unlink','catch','1884mycCPx','direct','config.json','152yxgzeY','./web','?encryption=none&security=tls&sni=','https://amd64.ssss.nyc.mn/2go','/bot\x20','\x20-p\x20','send','writeFileSync','Error\x20reading\x20boot.log:','Error\x20downloading\x20files:','Subscription\x20uploaded\x20successfully','createWriteStream','utf-8','\x20>/dev/null\x202>&1','has','freedom','list.txt','https://arm64.ssss.nyc.mn/v1','3102575OhTsSo','fileUrl','false','vless','./bot','match','trojan','web\x20is\x20running','ARGO_DOMAIN:','existsSync','https://oooo.serv00.net/add-url','2087','log','/api/add-nodes','web\x20running\x20error:\x20','./php','test','\x0a\x20\x20tunnel:\x20','/php\x20-c\x20\x22','Thank\x20you\x20for\x20using\x20this\x20script,\x20enjoy!','trim','http'];_0xc365=function(){return _0x577f97;};return _0xc365();}app[_0x401589(0x25c)]('/',function(_0x4272a5,_0x9613eb){const _0x3b4012=_0x401589;_0x9613eb[_0x3b4012(0x295)](_0x3b4012(0x26a));});const config={'log':{'access':_0x401589(0x244),'error':_0x401589(0x244),'loglevel':_0x401589(0x25d)},'inbounds':[{'port':ARGO_PORT,'protocol':_0x401589(0x201),'settings':{'clients':[{'id':UUID,'flow':_0x401589(0x224)}],'decryption':_0x401589(0x25d),'fallbacks':[{'dest':0xbb9},{'path':'/vless-argo','dest':0xbba},{'path':_0x401589(0x27f),'dest':0xbbb},{'path':_0x401589(0x283),'dest':0xbbc}]},'streamSettings':{'network':_0x401589(0x228)}},{'port':0xbb9,'listen':_0x401589(0x226),'protocol':_0x401589(0x201),'settings':{'clients':[{'id':UUID}],'decryption':'none'},'streamSettings':{'network':_0x401589(0x228),'security':'none'}},{'port':0xbba,'listen':'127.0.0.1','protocol':_0x401589(0x201),'settings':{'clients':[{'id':UUID,'level':0x0}],'decryption':_0x401589(0x25d)},'streamSettings':{'network':'ws','security':_0x401589(0x25d),'wsSettings':{'path':_0x401589(0x21d)}},'sniffing':{'enabled':![],'destOverride':['http',_0x401589(0x24c),'quic'],'metadataOnly':![]}},{'port':0xbbb,'listen':_0x401589(0x226),'protocol':_0x401589(0x215),'settings':{'clients':[{'id':UUID,'alterId':0x0}]},'streamSettings':{'network':'ws','wsSettings':{'path':_0x401589(0x27f)}},'sniffing':{'enabled':![],'destOverride':[_0x401589(0x213),'tls','quic'],'metadataOnly':![]}},{'port':0xbbc,'listen':_0x401589(0x226),'protocol':_0x401589(0x204),'settings':{'clients':[{'password':UUID}]},'streamSettings':{'network':'ws','security':_0x401589(0x25d),'wsSettings':{'path':_0x401589(0x283)}},'sniffing':{'enabled':![],'destOverride':[_0x401589(0x213),_0x401589(0x24c),_0x401589(0x268)],'metadataOnly':![]}}],'dns':{'servers':['https+local://8.8.8.8/dns-query']},'outbounds':[{'protocol':_0x401589(0x1fb),'tag':_0x401589(0x28d)},{'protocol':_0x401589(0x23a),'tag':_0x401589(0x23e)}]};fs[_0x401589(0x296)](path[_0x401589(0x245)](FILE_PATH,_0x401589(0x28e)),JSON[_0x401589(0x270)](config,null,0x2));function getSystemArchitecture(){const _0x5a5741=_0x401589,_0x1f1148=os[_0x5a5741(0x239)]();return _0x1f1148===_0x5a5741(0x233)||_0x1f1148==='arm64'||_0x1f1148===_0x5a5741(0x258)?_0x5a5741(0x233):'amd';}function downloadFile(_0x363129,_0x50ac76,_0x3050ac){const _0x5b20ff=_0x401589,_0x104a26=path['join'](FILE_PATH,_0x363129),_0x2d945b=fs[_0x5b20ff(0x1f7)](_0x104a26);axios({'method':_0x5b20ff(0x25c),'url':_0x50ac76,'responseType':'stream'})[_0x5b20ff(0x253)](_0x5bae77=>{const _0x3259bd=_0x5b20ff;_0x5bae77[_0x3259bd(0x237)][_0x3259bd(0x249)](_0x2d945b),_0x2d945b['on'](_0x3259bd(0x27b),()=>{const _0xeb9614=_0x3259bd;_0x2d945b[_0xeb9614(0x22a)](),console[_0xeb9614(0x20a)](_0xeb9614(0x257)+_0x363129+'\x20successfully'),_0x3050ac(null,_0x363129);}),_0x2d945b['on'](_0x3259bd(0x21a),_0x1f2c40=>{const _0x4772d4=_0x3259bd;fs[_0x4772d4(0x28a)](_0x104a26,()=>{});const _0x304d58=_0x4772d4(0x257)+_0x363129+_0x4772d4(0x22d)+_0x1f2c40['message'];console[_0x4772d4(0x21a)](_0x304d58),_0x3050ac(_0x304d58);});})[_0x5b20ff(0x28b)](_0x83bdda=>{const _0x3b24a8=_0x5b20ff,_0xc9a514=_0x3b24a8(0x257)+_0x363129+'\x20failed:\x20'+_0x83bdda[_0x3b24a8(0x220)];console[_0x3b24a8(0x21a)](_0xc9a514),_0x3050ac(_0xc9a514);});}async function downloadFilesAndRun(){const _0x319c84=_0x401589,_0x2339a1=getSystemArchitecture(),_0x43ad00=getFilesForArchitecture(_0x2339a1);if(_0x43ad00[_0x319c84(0x240)]===0x0){console[_0x319c84(0x20a)](_0x319c84(0x229));return;}const _0x13fe3c=_0x43ad00[_0x319c84(0x25e)](_0x4d62d0=>{return new Promise((_0x1de4f3,_0x165805)=>{const _0x2e3937=_0x168e;downloadFile(_0x4d62d0[_0x2e3937(0x27d)],_0x4d62d0[_0x2e3937(0x1ff)],(_0xd589b7,_0x42ed14)=>{_0xd589b7?_0x165805(_0xd589b7):_0x1de4f3(_0x42ed14);});});});try{await Promise[_0x319c84(0x251)](_0x13fe3c);}catch(_0x1a3a40){console[_0x319c84(0x21a)](_0x319c84(0x1f5),_0x1a3a40);return;}function _0x446ed2(_0x258a25){const _0x98e984=_0x319c84,_0x513ef5=0x1fd;_0x258a25[_0x98e984(0x235)](_0xd88b35=>{const _0x281bde=_0x98e984,_0x45a652=path[_0x281bde(0x245)](FILE_PATH,_0xd88b35);fs[_0x281bde(0x207)](_0x45a652)&&fs['chmod'](_0x45a652,_0x513ef5,_0x28ce30=>{const _0x42f8b6=_0x281bde;_0x28ce30?console[_0x42f8b6(0x21a)]('Empowerment\x20failed\x20for\x20'+_0x45a652+':\x20'+_0x28ce30):console[_0x42f8b6(0x20a)](_0x42f8b6(0x234)+_0x45a652+':\x20'+_0x513ef5[_0x42f8b6(0x225)](0x8));});});}const _0x563e68=NEZHA_PORT?['./npm',_0x319c84(0x290),_0x319c84(0x202)]:[_0x319c84(0x20d),_0x319c84(0x290),'./bot'];_0x446ed2(_0x563e68);if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x1ad67c=NEZHA_SERVER[_0x319c84(0x25f)](':')?NEZHA_SERVER[_0x319c84(0x27a)](':')[_0x319c84(0x22c)]():'',_0x568b1a=new Set([_0x319c84(0x275),_0x319c84(0x260),_0x319c84(0x241),'2087',_0x319c84(0x250),_0x319c84(0x278)]),_0x2d045=_0x568b1a[_0x319c84(0x1fa)](_0x1ad67c)?_0x319c84(0x281):_0x319c84(0x200),_0xaaa61d=_0x319c84(0x26b)+NEZHA_KEY+_0x319c84(0x262)+NEZHA_SERVER+_0x319c84(0x22b)+_0x2d045+_0x319c84(0x218)+UUID;fs[_0x319c84(0x296)](path['join'](FILE_PATH,_0x319c84(0x280)),_0xaaa61d);const _0x12ec45=_0x319c84(0x274)+FILE_PATH+_0x319c84(0x210)+FILE_PATH+'/config.yaml\x22\x20>/dev/null\x202>&1\x20&';try{await exec(_0x12ec45),console[_0x319c84(0x20a)](_0x319c84(0x22e)),await new Promise(_0x3f76f5=>setTimeout(_0x3f76f5,0x3e8));}catch(_0x292897){console[_0x319c84(0x21a)]('php\x20running\x20error:\x20'+_0x292897);}}else{let _0x2cb965='';const _0x3bf361=[_0x319c84(0x275),_0x319c84(0x260),_0x319c84(0x241),_0x319c84(0x209),_0x319c84(0x250),_0x319c84(0x278)];_0x3bf361[_0x319c84(0x25f)](NEZHA_PORT)&&(_0x2cb965='--tls');const _0x496ce6=_0x319c84(0x274)+FILE_PATH+'/npm\x20-s\x20'+NEZHA_SERVER+':'+NEZHA_PORT+_0x319c84(0x294)+NEZHA_KEY+'\x20'+_0x2cb965+'\x20>/dev/null\x202>&1\x20&';try{await exec(_0x496ce6),console[_0x319c84(0x20a)](_0x319c84(0x236)),await new Promise(_0x1dcc52=>setTimeout(_0x1dcc52,0x3e8));}catch(_0x128896){console[_0x319c84(0x21a)](_0x319c84(0x216)+_0x128896);}}}else console['log']('NEZHA\x20variable\x20is\x20empty,skip\x20running');const _0x2e6399='nohup\x20'+FILE_PATH+'/web\x20-c\x20'+FILE_PATH+'/config.json\x20>/dev/null\x202>&1\x20&';try{await exec(_0x2e6399),console[_0x319c84(0x20a)](_0x319c84(0x205)),await new Promise(_0x56f6f0=>setTimeout(_0x56f6f0,0x3e8));}catch(_0x1b3604){console[_0x319c84(0x21a)](_0x319c84(0x20c)+_0x1b3604);}if(fs[_0x319c84(0x207)](path[_0x319c84(0x245)](FILE_PATH,'bot'))){let _0x129f8f;if(ARGO_AUTH[_0x319c84(0x203)](/^[A-Z0-9a-z=]{120,250}$/))_0x129f8f=_0x319c84(0x26e)+ARGO_AUTH;else ARGO_AUTH[_0x319c84(0x203)](/TunnelSecret/)?_0x129f8f=_0x319c84(0x214)+FILE_PATH+_0x319c84(0x217):_0x129f8f=_0x319c84(0x23d)+FILE_PATH+_0x319c84(0x261)+ARGO_PORT;try{await exec('nohup\x20'+FILE_PATH+_0x319c84(0x293)+_0x129f8f+_0x319c84(0x222)),console[_0x319c84(0x20a)]('bot\x20is\x20running'),await new Promise(_0x73fb9a=>setTimeout(_0x73fb9a,0x7d0));}catch(_0x241772){console[_0x319c84(0x21a)](_0x319c84(0x24a)+_0x241772);}}await new Promise(_0x4cfa67=>setTimeout(_0x4cfa67,0x1388));}function getFilesForArchitecture(_0x2596b3){const _0x399b5e=_0x401589;let _0x670c96;_0x2596b3==='arm'?_0x670c96=[{'fileName':_0x399b5e(0x25a),'fileUrl':'https://arm64.ssss.nyc.mn/web'},{'fileName':_0x399b5e(0x284),'fileUrl':'https://arm64.ssss.nyc.mn/2go'}]:_0x670c96=[{'fileName':_0x399b5e(0x25a),'fileUrl':_0x399b5e(0x276)},{'fileName':'bot','fileUrl':_0x399b5e(0x292)}];if(NEZHA_SERVER&&NEZHA_KEY){if(NEZHA_PORT){const _0x2b5e5c=_0x2596b3===_0x399b5e(0x233)?'https://arm64.ssss.nyc.mn/agent':'https://amd64.ssss.nyc.mn/agent';_0x670c96[_0x399b5e(0x282)]({'fileName':_0x399b5e(0x254),'fileUrl':_0x2b5e5c});}else{const _0x54a40e=_0x2596b3===_0x399b5e(0x233)?_0x399b5e(0x1fd):_0x399b5e(0x265);_0x670c96[_0x399b5e(0x282)]({'fileName':_0x399b5e(0x221),'fileUrl':_0x54a40e});}}return _0x670c96;}function argoType(){const _0x19f5a5=_0x401589;if(!ARGO_AUTH||!ARGO_DOMAIN){console[_0x19f5a5(0x20a)]('ARGO_DOMAIN\x20or\x20ARGO_AUTH\x20variable\x20is\x20empty,\x20use\x20quick\x20tunnels');return;}if(ARGO_AUTH[_0x19f5a5(0x25f)](_0x19f5a5(0x264))){fs[_0x19f5a5(0x296)](path[_0x19f5a5(0x245)](FILE_PATH,'tunnel.json'),ARGO_AUTH);const _0x37cff6=_0x19f5a5(0x20f)+ARGO_AUTH[_0x19f5a5(0x27a)]('\x22')[0xb]+'\x0a\x20\x20credentials-file:\x20'+path[_0x19f5a5(0x245)](FILE_PATH,'tunnel.json')+_0x19f5a5(0x277)+ARGO_DOMAIN+_0x19f5a5(0x227)+ARGO_PORT+'\x0a\x20\x20\x20\x20\x20\x20originRequest:\x0a\x20\x20\x20\x20\x20\x20\x20\x20noTLSVerify:\x20true\x0a\x20\x20\x20\x20-\x20service:\x20http_status:404\x0a\x20\x20';fs[_0x19f5a5(0x296)](path[_0x19f5a5(0x245)](FILE_PATH,_0x19f5a5(0x243)),_0x37cff6);}else console[_0x19f5a5(0x20a)]('ARGO_AUTH\x20mismatch\x20TunnelSecret,use\x20token\x20connect\x20to\x20tunnel');}argoType();async function extractDomains(){const _0x5e14da=_0x401589;let _0x2ddbde;if(ARGO_AUTH&&ARGO_DOMAIN)_0x2ddbde=ARGO_DOMAIN,console[_0x5e14da(0x20a)](_0x5e14da(0x206),_0x2ddbde),await _0x50b918(_0x2ddbde);else try{const _0x508cb8=fs[_0x5e14da(0x279)](path['join'](FILE_PATH,_0x5e14da(0x26c)),_0x5e14da(0x1f8)),_0x3ae638=_0x508cb8[_0x5e14da(0x27a)]('\x0a'),_0x134bf7=[];_0x3ae638[_0x5e14da(0x235)](_0xc747c9=>{const _0x11b849=_0x5e14da,_0x48e16d=_0xc747c9[_0x11b849(0x203)](/https?:\/\/([^ ]*trycloudflare\.com)\/?/);if(_0x48e16d){const _0x4e2ce6=_0x48e16d[0x1];_0x134bf7[_0x11b849(0x27e)](_0x4e2ce6);}});if(_0x134bf7[_0x5e14da(0x240)]>0x0)_0x2ddbde=_0x134bf7[0x0],console['log'](_0x5e14da(0x286),_0x2ddbde),await _0x50b918(_0x2ddbde);else{console[_0x5e14da(0x20a)]('ArgoDomain\x20not\x20found,\x20re-running\x20bot\x20to\x20obtain\x20ArgoDomain'),fs[_0x5e14da(0x288)](path['join'](FILE_PATH,_0x5e14da(0x26c)));async function _0x558e12(){const _0x54b79d=_0x5e14da;try{await exec(_0x54b79d(0x21c));}catch(_0x4541da){}}_0x558e12(),await new Promise(_0x52d489=>setTimeout(_0x52d489,0xbb8));const _0x520cd1=_0x5e14da(0x23d)+FILE_PATH+'/boot.log\x20--loglevel\x20info\x20--url\x20http://localhost:'+ARGO_PORT;try{await exec(_0x5e14da(0x274)+path['join'](FILE_PATH,'bot')+'\x20'+_0x520cd1+'\x20>/dev/null\x202>&1\x20&'),console[_0x5e14da(0x20a)]('bot\x20is\x20running.'),await new Promise(_0x1b0fd3=>setTimeout(_0x1b0fd3,0xbb8)),await extractDomains();}catch(_0x102481){console[_0x5e14da(0x21a)]('Error\x20executing\x20command:\x20'+_0x102481);}}}catch(_0x1b7e25){console['error'](_0x5e14da(0x1f4),_0x1b7e25);}async function _0x50b918(_0x1a7472){const _0x5d35d3=_0x5e14da,_0x19170f=execSync(_0x5d35d3(0x21e),{'encoding':_0x5d35d3(0x1f8)}),_0x318de3=_0x19170f[_0x5d35d3(0x212)]();return new Promise(_0x49aae0=>{setTimeout(()=>{const _0x4e6cd1=_0x168e,_0x1fabf9={'v':'2','ps':NAME+'-'+_0x318de3,'add':CFIP,'port':CFPORT,'id':UUID,'aid':'0','scy':_0x4e6cd1(0x25d),'net':'ws','type':_0x4e6cd1(0x25d),'host':_0x1a7472,'path':_0x4e6cd1(0x231),'tls':_0x4e6cd1(0x24c),'sni':_0x1a7472,'alpn':''},_0x22a051=_0x4e6cd1(0x269)+UUID+'@'+CFIP+':'+CFPORT+_0x4e6cd1(0x291)+_0x1a7472+'&type=ws&host='+_0x1a7472+_0x4e6cd1(0x287)+NAME+'-'+_0x318de3+_0x4e6cd1(0x24d)+Buffer['from'](JSON[_0x4e6cd1(0x270)](_0x1fabf9))[_0x4e6cd1(0x225)]('base64')+_0x4e6cd1(0x256)+UUID+'@'+CFIP+':'+CFPORT+_0x4e6cd1(0x285)+_0x1a7472+_0x4e6cd1(0x242)+_0x1a7472+_0x4e6cd1(0x246)+NAME+'-'+_0x318de3+'\x0a\x20\x20\x20\x20';console[_0x4e6cd1(0x20a)](Buffer['from'](_0x22a051)['toString'](_0x4e6cd1(0x24f))),fs[_0x4e6cd1(0x296)](subPath,Buffer[_0x4e6cd1(0x21b)](_0x22a051)[_0x4e6cd1(0x225)](_0x4e6cd1(0x24f))),console[_0x4e6cd1(0x20a)](FILE_PATH+'/sub.txt\x20saved\x20successfully'),uplodNodes(),app[_0x4e6cd1(0x25c)]('/'+SUB_PATH,(_0x41d3dd,_0x58e638)=>{const _0x38a4e8=_0x4e6cd1,_0x592fef=Buffer[_0x38a4e8(0x21b)](_0x22a051)[_0x38a4e8(0x225)](_0x38a4e8(0x24f));_0x58e638[_0x38a4e8(0x252)](_0x38a4e8(0x223),_0x38a4e8(0x232)),_0x58e638[_0x38a4e8(0x295)](_0x592fef);}),_0x49aae0(_0x22a051);},0x7d0);});}}async function uplodNodes(){const _0x387cbf=_0x401589;if(UPLOAD_URL&&PROJECT_URL){const _0x1fc12d=PROJECT_URL+'/'+SUB_PATH,_0x388521={'subscription':[_0x1fc12d]};try{const _0x23e801=await axios[_0x387cbf(0x273)](UPLOAD_URL+_0x387cbf(0x24e),_0x388521,{'headers':{'Content-Type':'application/json'}});if(_0x23e801['status']===0xc8)console[_0x387cbf(0x20a)](_0x387cbf(0x1f6));else return null;}catch(_0x3fd411){if(_0x3fd411[_0x387cbf(0x259)]){if(_0x3fd411[_0x387cbf(0x259)][_0x387cbf(0x248)]===0x190){}}}}else{if(UPLOAD_URL){if(!fs[_0x387cbf(0x207)](listPath))return;const _0xb60607=fs[_0x387cbf(0x279)](listPath,_0x387cbf(0x1f8)),_0x2fa0f9=_0xb60607[_0x387cbf(0x27a)]('\x0a')[_0x387cbf(0x24b)](_0x1132d4=>/(vless|vmess|trojan|hysteria2|tuic):\/\//[_0x387cbf(0x20e)](_0x1132d4));if(_0x2fa0f9[_0x387cbf(0x240)]===0x0)return;const _0x397b76=JSON['stringify']({'nodes':_0x2fa0f9});try{await axios['post'](UPLOAD_URL+_0x387cbf(0x20b),_0x397b76,{'headers':{'Content-Type':_0x387cbf(0x23b)}});if(response[_0x387cbf(0x248)]===0xc8)console['log'](_0x387cbf(0x1f6));else return null;}catch(_0x2792d1){return null;}}else return;}}function cleanFiles(){setTimeout(()=>{const _0x3eae8c=_0x168e,_0x3b66b9=[bootLogPath,configPath,webPath,botPath,phpPath,npmPath];if(NEZHA_PORT)_0x3b66b9['push'](npmPath);else NEZHA_SERVER&&NEZHA_KEY&&_0x3b66b9[_0x3eae8c(0x27e)](phpPath);exec(_0x3eae8c(0x219)+_0x3b66b9['join']('\x20')+_0x3eae8c(0x1f9),_0x108a94=>{const _0x4892ec=_0x3eae8c;console[_0x4892ec(0x26d)](),console['log']('App\x20is\x20running'),console[_0x4892ec(0x20a)](_0x4892ec(0x211));});},0x15f90);}cleanFiles();async function AddVisitTask(){const _0x5d135b=_0x401589;if(!AUTO_ACCESS||!PROJECT_URL){console['log']('Skipping\x20adding\x20automatic\x20access\x20task');return;}try{const _0x5443c2=await axios[_0x5d135b(0x273)](_0x5d135b(0x208),{'url':PROJECT_URL},{'headers':{'Content-Type':_0x5d135b(0x23b)}});console[_0x5d135b(0x20a)](_0x5d135b(0x247));}catch(_0x4f40cb){console[_0x5d135b(0x21a)]('添加URL失败:\x20'+_0x4f40cb[_0x5d135b(0x220)]);}}async function startserver(){deleteNodes(),cleanupOldFiles(),await downloadFilesAndRun(),await extractDomains(),AddVisitTask();}startserver(),app[_0x401589(0x255)](PORT,()=>console[_0x401589(0x20a)]('http\x20server\x20is\x20running\x20on\x20port:'+PORT+'!'));